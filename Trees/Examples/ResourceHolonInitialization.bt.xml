<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4" main_tree_to_execute="ResourceHolonInitialization">
  <BehaviorTree ID="ResourceHolonInitialization">
    
    <!-- 
      Initialisierungs-Tree für Resource Holon
      Lädt Konfiguration, verbindet zu Systemen und lädt AAS-Daten
    -->
    
    <Sequence name="InitSequence">
      
      <!-- Phase 1: Lade globale Konfiguration -->
      <ReadConfig configPath="config.json" />
      
      <!-- Phase 2: Verbinde zu MQTT Broker -->
      <Retry maxRetries="3" backoffMs="500">
        <ConnectToMessagingBroker />
      </Retry>
      
      <!-- Phase 3: Lade AAS-Daten parallel -->
      <Parallel name="LoadAASData" successThreshold="4">
        <ReadShell />
        <ReadCapabilityDescription />
        <ReadSkills />
        <ReadMachineSchedule />
      </Parallel>
      
      <!-- Phase 4: Verbinde zu OPC UA Modul (optional) -->
      <Succeeder>
        <Timeout timeoutMs="5000">
          <ConnectToModule />
        </Timeout>
      </Succeeder>
      
      <!-- Phase 5: Registriere Modul im System -->
      <CoupleModule />
      
    </Sequence>
    
  </BehaviorTree>
  
  <!-- TreeNodesModel for Groot2 Editor -->
  <TreeNodesModel>
    <Decorator ID="RetryUntilSuccess">
      <input_port name="numAttempts" default="-1"/>
      <input_port name="delayMs" default="1000"/>
    </Decorator>
    <Action ID="ReadConfig">
      <input_port name="configPath"/>
    </Action>
    <Action ID="ConnectToMessagingBroker"/>
    <Action ID="ReadShell"/>
    <Action ID="ReadCapabilityDescription"/>
    <Action ID="ReadSkills"/>
    <Action ID="ReadMachineSchedule"/>
    <Action ID="ConnectToModule"/>
    <Action ID="CoupleModule"/>
  </TreeNodesModel>
</root>
